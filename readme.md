# PDF阅读器与AI助手

一个集成了PDF阅读、文本分析和AI对话功能的Web应用。

## to do
- [ ] 重新整理代码库，删掉冗余，合并同类项
- [ ] ollama实现rag


## 项目结构

```
project/
├── static/
│   ├── css/
│   │   └── style.css      # 样式文件
│   ├── js/
│   │   └── main.js        # 主要JavaScript逻辑
│   ├── uploads/           # 保存已经上传的pdf，启动时自动载入
│   └── histories/         # 保存对话历史，包含会话内容和名称
│       └── chat_histories.json  # 对话历史存储文件
├── templates/
│   └── index.html         # 主页面模板
└── app.py                 # Flask后端应用
└── utils.py               # 一些工具
```

### 支持的AI模型

- Ollama-llama3.2
  - 基础对话、翻译和分析功能
  - 暂不支持RAG（检索增强生成）技术，故**pdf列表中的勾选和取消功能功能未启用，点击无反应，需要切换模型选择为千问**

- 通义千问
  - 完整的对话、翻译和分析功能
  - 支持RAG技术
  - 可以使用文档参考功能

### 文件说明

- `app.py`: Flask后端应用
  - 处理文件上传和删除
  - 提供AI接口服务
  - 管理文件存储（仅千问模型）
  - 维护AI助手的参考文件列表（仅千问模型）
  - 管理对话历史的保存和加载
  - 自动创建必要的存储目录

- `templates/index.html`: 主页面模板
  - 定义页面基本结构
  - 包含PDF查看器、文件管理侧边栏和聊天界面
  - 集成文件上传输入框
  - 历史对话管理界面

- `static/css/style.css`: 样式文件
  - 定义页面布局和样式
  - 实现响应式设计
  - 控制组件外观
  - 优化历史记录侧边栏的折叠效果

- `static/js/main.js`: 主要JavaScript逻辑
  - PDF文件处理和显示
  - 文本选择和AI交互
  - 文件管理功能
    - 自动载入已经上传的文档
  - 对话历史管理
    - 自动保存对话内容
    - 支持编辑对话名称
    - 按时间倒序排列对话列表
  - 会话切换功能
  - 缩放控制

### 实现细节

#### 文件管理机制
- 使用文件输入框处理文件上传
- 在删除文件后自动清除输入框状态，确保同一文件可以立即重新上传
- 维护物理文件和AI助手参考文件列表的同步
- 启动时自动加载已上传的PDF文件

#### 对话历史管理
- 自动保存每个对话的内容和名称
- 支持实时编辑对话名称
- 按时间顺序组织对话列表（新的在上方）
- 保存当前活动对话的状态
- 支持会话切换和删除操作

#### 缓存处理
- 主动清除文件输入框值
- 避免浏览器缓存影响文件重复上传
- 确保文件操作的一致性和可预测性
- 对话历史持久化存储

#### 即时更新
- 目前部署的前端网页项目，可以在修改了相应源代码后，不重启网页也可即时更新改动

## 安装和运行

1. 安装依赖
    ```bash
    pip install flask
    ```
   - [ ] 补充qwen和ollama的依赖安装

2. 运行应用
    ```bash
    DASHSCOPE_API_KEY=<api_key> python app.py
    ```
    - [ ] ollama还要在本地启动服务端

3. 访问应用
    打开浏览器访问 http://localhost:5000

## 注意事项

- 首次启动时会自动创建 `static/uploads` 和 `static/histories` 目录
- 对话历史会自动保存到 `static/histories/chat_histories.json` 文件中
- 已上传的PDF文件会在应用启动时自动加载到文件列表中
- PDF文件的检索状态（复选框）在每次启动时默认为未选中状态